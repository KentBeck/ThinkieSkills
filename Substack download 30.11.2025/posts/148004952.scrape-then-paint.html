<blockquote><p>First published July 2017</p></blockquote><p>I was twelve the first time I got paid to work. I was helping renovate a house, out in the burning sun, a wooden-handled scraper/wire brush heavy in my hands.</p><p>My first target was an outdoor bannister. I gave it a few swipes, got hot, and went inside to find a cooler job. Dick called me back out. “You need to scrape and brush until all the loose paint chips are gone. Otherwise, we’ll paint it, it’ll look good, but next spring it’ll start flaking and we’ll have to do it again.”</p><p>I got back to work, finding, despite the heat and the sweat, satisfaction in doing a job that would last.</p><h2><strong>Test Coverage</strong></h2><p>Studying better engineering is based on a collective realization that we (sometimes, more on that later) need to shift our development efforts towards the long term. Quality matters. But how, with a measurement-oriented culture, do you measure quality?</p><p>The consequences of code quality are either hard to measure or lag far behind changes of quality:</p><ul><li><p>How easy is it to add features?</p></li><li><p>How many SEVs did it cause?</p></li><li><p>How quickly can people learn it?</p></li><li><p>(Ultimately) How much community does it build?</p></li></ul><p>Test coverage, on the other hand, is easy to measure and measurable today. In the absence of changes to design practices, however, test coverage is at best worthless and at worst a distraction from more important issues.</p><h2><strong>Production Predictor</strong></h2><p>The ideal test suite is an instant <a href="https://kentbeck.github.io/TestDesiderata/">production predictor</a>. If the tests run, production will be fine if you push. If the tests fail, a production push would fail. The test suite will never be a perfect production predictor, but you can continually make it better.</p><p>The problem is that by the time we get to the test suite, it’s already too late because of the Universal Law of Testing:</p><div class="pullquote"><p><em>The number of defects leaving a feedback loop is proportional to the number of defects entering</em></p></div><p>The code is composed of large elements (functions, classes, files, modules), unnecessarily-shared mutable state, complex control structures, vestigial code, duplicated code, and implicit coupling. You don’t have bugs because you don’t have tests. You have bugs because you write code that makes it easy to have bugs. You have a design problem, not a testing problem.</p><h2><strong>Prescription</strong></h2><ul><li><p>Improve cohesion by reducing the size of elements</p></li><li><p>Unify duplicated logic</p></li><li><p>Replace duplicated conditionals with polymorphism</p></li><li><p>Use immutable data structures where feasible to eliminate aliasing errors</p></li><li><p>Eliminate dead code</p></li><li><p>Rationalize naming so the right names are likelier to be guessed</p></li><li><p>Simplify control flows where possible</p></li></ul><p>Once the system is closer to being composed out of cohesive, loosely coupled elements, then and only then does test coverage begin to correlate with the predictive power of the test suite. As long as changing a line has a significant chance of unexpected consequences, whether that line is covered or not doesn’t really matter.</p><h2><strong>Priorities</strong></h2><div class="captioned-image-container"><figure><a class="image-link image2 is-viewable-img" target="_blank" href="https://substackcdn.com/image/fetch/$s_!XlE2!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7b0ca7cf-70b2-4496-a32d-48a29dccde54_591x277.png" data-component-name="Image2ToDOM"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/$s_!XlE2!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7b0ca7cf-70b2-4496-a32d-48a29dccde54_591x277.png 424w, https://substackcdn.com/image/fetch/$s_!XlE2!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7b0ca7cf-70b2-4496-a32d-48a29dccde54_591x277.png 848w, https://substackcdn.com/image/fetch/$s_!XlE2!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7b0ca7cf-70b2-4496-a32d-48a29dccde54_591x277.png 1272w, https://substackcdn.com/image/fetch/$s_!XlE2!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7b0ca7cf-70b2-4496-a32d-48a29dccde54_591x277.png 1456w" sizes="100vw"><img src="https://substack-post-media.s3.amazonaws.com/public/images/7b0ca7cf-70b2-4496-a32d-48a29dccde54_591x277.png" width="591" height="277" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/7b0ca7cf-70b2-4496-a32d-48a29dccde54_591x277.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:277,&quot;width&quot;:591,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:208878,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}" class="sizing-normal" alt="" srcset="https://substackcdn.com/image/fetch/$s_!XlE2!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7b0ca7cf-70b2-4496-a32d-48a29dccde54_591x277.png 424w, https://substackcdn.com/image/fetch/$s_!XlE2!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7b0ca7cf-70b2-4496-a32d-48a29dccde54_591x277.png 848w, https://substackcdn.com/image/fetch/$s_!XlE2!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7b0ca7cf-70b2-4496-a32d-48a29dccde54_591x277.png 1272w, https://substackcdn.com/image/fetch/$s_!XlE2!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7b0ca7cf-70b2-4496-a32d-48a29dccde54_591x277.png 1456w" sizes="100vw" loading="lazy"></picture><div class="image-link-expand"><div class="pencraft pc-display-flex pc-gap-8 pc-reset"><button tabindex="0" type="button" class="pencraft pc-reset pencraft icon-container restack-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-refresh-cw"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path><path d="M21 3v5h-5"></path><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path><path d="M8 16H3v5"></path></svg></button><button tabindex="0" type="button" class="pencraft pc-reset pencraft icon-container view-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-maximize2 lucide-maximize-2"><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" x2="14" y1="3" y2="10"></line><line x1="3" x2="10" y1="21" y2="14"></line></svg></button></div></div></div></a><figcaption class="image-caption">The relative cost of de-coupling code versus dealing with coupling changes as the code lives longer</figcaption></figure></div><p>Another way of interpreting efforts to improve engineering is that they recognize that parts of the code base have made this shift to longer half-lives. The cultural challenge is that de-coupling is hard work, provides no immediate payoff, can disconnect from actual progress, and is hard to measure. Test coverage, on the other hand, is easy to measure, easy to make progress on, and easy to justify short-term.</p><p>I’m 100% in favor of slowing down to speed up, where we know code will be valuable long-term. I’m in favor of better test coverage. But you have some hard, sweaty, unglamorous work to do first. Otherwise, you risk testing the hell out of error-prone code, only to have to test the hell out of tomorrow’s error-prone code. And the next day’s. And the next.</p><h2><strong>P.S. One Exception</strong></h2><p>One scenario where test coverage provides value today is answering the question, “You know this line I just changed? Is it being exercised?” If it isn’t, it’s time to ask, “Am I comfortable with this change first being executed outside of my direct control when it’s in production?” Maybe yes, maybe no, but test coverage eliminates a class of errors where you accidentally didn’t even check.</p>