<p>I can’t believe I’m still writing this kind of stuff, but here we are. The design &amp; implementation of test-driven code is exactly as good as the design &amp; implementation decisions that go into that code. Exactly the same as code that isn’t test-driven.</p><p>Here’s one strawman argument, in particular, that I want to refute—using TDD you’ll never generalize.</p><div><hr></div><p><em>Thanks to today’s sponsor Unblocked.</em></p><p>When I was a young programmer we were berated for not writing more documentation, but that documentation always turned out to be useless by the time we needed it. That experience was my impetus for writing about communicative code (Smalltalk Best Practice Patterns &amp; Implementation Patterns).</p><p><a href="https://getunblocked.com/?utm_source=tidyfirst&amp;utm_medium=email&amp;utm_campaign=tidyfirst">Unblocked</a> meets the same need in the same moment--I have to change this code but what is going on? Unblocked answers this question with less effort on the part of the original programmer &amp; the answers are always up-to-date.</p><div class="captioned-image-container"><figure><a class="image-link image2 is-viewable-img" target="_blank" href="https://getunblocked.com/?utm_source=tidyfirst&amp;utm_medium=email&amp;utm_campaign=tidyfirst" data-component-name="Image2ToDOM"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/$s_!j8Na!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F424d0895-88e5-4f5e-9370-e32be34c9221_3692x1846.png 424w, https://substackcdn.com/image/fetch/$s_!j8Na!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F424d0895-88e5-4f5e-9370-e32be34c9221_3692x1846.png 848w, https://substackcdn.com/image/fetch/$s_!j8Na!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F424d0895-88e5-4f5e-9370-e32be34c9221_3692x1846.png 1272w, https://substackcdn.com/image/fetch/$s_!j8Na!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F424d0895-88e5-4f5e-9370-e32be34c9221_3692x1846.png 1456w" sizes="100vw"><img src="https://substack-post-media.s3.amazonaws.com/public/images/424d0895-88e5-4f5e-9370-e32be34c9221_3692x1846.png" width="1456" height="728" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/424d0895-88e5-4f5e-9370-e32be34c9221_3692x1846.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:728,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:4183565,&quot;alt&quot;:&quot;&quot;,&quot;title&quot;:&quot;&quot;,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:&quot;https://getunblocked.com/?utm_source=tidyfirst&amp;utm_medium=email&amp;utm_campaign=tidyfirst&quot;,&quot;belowTheFold&quot;:false,&quot;topImage&quot;:true,&quot;internalRedirect&quot;:&quot;https://tidyfirst.substack.com/i/159429711?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F424d0895-88e5-4f5e-9370-e32be34c9221_3692x1846.png&quot;,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}" class="sizing-normal" alt="" title="" srcset="https://substackcdn.com/image/fetch/$s_!j8Na!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F424d0895-88e5-4f5e-9370-e32be34c9221_3692x1846.png 424w, https://substackcdn.com/image/fetch/$s_!j8Na!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F424d0895-88e5-4f5e-9370-e32be34c9221_3692x1846.png 848w, https://substackcdn.com/image/fetch/$s_!j8Na!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F424d0895-88e5-4f5e-9370-e32be34c9221_3692x1846.png 1272w, https://substackcdn.com/image/fetch/$s_!j8Na!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F424d0895-88e5-4f5e-9370-e32be34c9221_3692x1846.png 1456w" sizes="100vw" fetchpriority="high"></picture><div class="image-link-expand"><div class="pencraft pc-display-flex pc-gap-8 pc-reset"><button tabindex="0" type="button" class="pencraft pc-reset pencraft icon-container restack-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-refresh-cw"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path><path d="M21 3v5h-5"></path><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path><path d="M8 16H3v5"></path></svg></button><button tabindex="0" type="button" class="pencraft pc-reset pencraft icon-container view-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-maximize2 lucide-maximize-2"><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" x2="14" y1="3" y2="10"></line><line x1="3" x2="10" y1="21" y2="14"></line></svg></button></div></div></div></a></figure></div><div><hr></div><h2>Example: Factorial</h2><p>We start with:</p><p><code>assert factorial(1) == 1</code></p><p>The implementation is easy:</p><p><code>function factorial(n)<br>  return 1</code></p><p>Now we add:</p><p><code>assert factorial(2) == 2</code></p><p>If we want to get to green as quickly as possible we have a couple of options. We’ll pick this one:</p><p><code>function factorial(n)<br>  if n == 1 return 1<br>  return 2</code></p><p>In the naive application of TDD strawmanned above, we’d just keep doing this, adding line after line after line to the factorial function. We don’t do this.</p><div class="captioned-image-container"><figure><a class="image-link image2 is-viewable-img" target="_blank" href="https://substackcdn.com/image/fetch/$s_!nLmy!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3cd4646d-e0b9-406a-8f9e-f32b3e1f3b89_2691x1250.jpeg" data-component-name="Image2ToDOM"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/$s_!nLmy!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3cd4646d-e0b9-406a-8f9e-f32b3e1f3b89_2691x1250.jpeg 424w, https://substackcdn.com/image/fetch/$s_!nLmy!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3cd4646d-e0b9-406a-8f9e-f32b3e1f3b89_2691x1250.jpeg 848w, https://substackcdn.com/image/fetch/$s_!nLmy!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3cd4646d-e0b9-406a-8f9e-f32b3e1f3b89_2691x1250.jpeg 1272w, https://substackcdn.com/image/fetch/$s_!nLmy!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3cd4646d-e0b9-406a-8f9e-f32b3e1f3b89_2691x1250.jpeg 1456w" sizes="100vw"><img src="https://substack-post-media.s3.amazonaws.com/public/images/3cd4646d-e0b9-406a-8f9e-f32b3e1f3b89_2691x1250.jpeg" width="1456" height="676" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/3cd4646d-e0b9-406a-8f9e-f32b3e1f3b89_2691x1250.jpeg&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:676,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:null,&quot;alt&quot;:&quot;Graph of red leading to green leading to refactor leading to write test leading back to red. red &amp; green are in dark blue ink &amp; labelled \&quot;behavior\&quot; and refactor &amp; write test are in red &amp; labelled \&quot;structure\&quot;&quot;,&quot;title&quot;:null,&quot;type&quot;:null,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}" class="sizing-normal" alt="Graph of red leading to green leading to refactor leading to write test leading back to red. red &amp; green are in dark blue ink &amp; labelled &quot;behavior&quot; and refactor &amp; write test are in red &amp; labelled &quot;structure&quot;" title="Graph of red leading to green leading to refactor leading to write test leading back to red. red &amp; green are in dark blue ink &amp; labelled &quot;behavior&quot; and refactor &amp; write test are in red &amp; labelled &quot;structure&quot;" srcset="https://substackcdn.com/image/fetch/$s_!nLmy!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3cd4646d-e0b9-406a-8f9e-f32b3e1f3b89_2691x1250.jpeg 424w, https://substackcdn.com/image/fetch/$s_!nLmy!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3cd4646d-e0b9-406a-8f9e-f32b3e1f3b89_2691x1250.jpeg 848w, https://substackcdn.com/image/fetch/$s_!nLmy!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3cd4646d-e0b9-406a-8f9e-f32b3e1f3b89_2691x1250.jpeg 1272w, https://substackcdn.com/image/fetch/$s_!nLmy!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3cd4646d-e0b9-406a-8f9e-f32b3e1f3b89_2691x1250.jpeg 1456w" sizes="100vw" loading="lazy"></picture><div class="image-link-expand"><div class="pencraft pc-display-flex pc-gap-8 pc-reset"><button tabindex="0" type="button" class="pencraft pc-reset pencraft icon-container restack-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-refresh-cw"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path><path d="M21 3v5h-5"></path><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path><path d="M8 16H3v5"></path></svg></button><button tabindex="0" type="button" class="pencraft pc-reset pencraft icon-container view-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-maximize2 lucide-maximize-2"><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" x2="14" y1="3" y2="10"></line><line x1="3" x2="10" y1="21" y2="14"></line></svg></button></div></div></div></a></figure></div><h2>Generalize</h2><p>Almost nobody does this (I could tell some stories…) Instead, most everybody eventually realizes that there’s structure implicit in the code above. That “2” in <code>factorial()</code> isn’t just an integer, it’s actually the product of two terms:</p><p><code>function factorial(n)<br>  if n == 1 return 1<br>  return 2 * 1</code></p><p>The “<code>2</code>” in “<code>2 * 1</code>” isn’t <em>really</em> a constant, it’s really the parameter <code>n</code>. If we generalize, the same tests will pass (“observationally equivalent” but that’s 2 chewy words).</p><p><code>function factorial(n)<br>  if n == 1 return 1<br>  return n * 1</code></p><p>The “<code>1</code>” in “<code>n * 1</code>” isn’t a constant either, it’s really the result of a recursive call.</p><p><code>function factorial(n)<br>  if n == 1 return 1<br>  return n * factorial(n - 1)</code></p><p>And there we have our perfectly general factorial function, test-driven, &amp; generalized in teensy-tiny steps.</p><h2>Challenges</h2><p>If all generalizations were this simple, programming would be easy. It isn’t easy, so all generalizations must not be this simple. The difficulties I encounter in practice are:</p><ul><li><p>I don’t have enough tests to constrain the code to only “good” states. I can have a naive simplifying assumption in my code for a while before I encounter a case where it doesn’t work.</p></li><li><p>I may not know how to generalize. I can 2 or 3 or 4 or 13 special cases in my code, sometimes for years, before I see how to generalize them. That’s okay, as long as the code works for the cases we care about.</p></li></ul><p>The thing that never happens is that I copypasta endlessly. I suppose this is one of the benefits of ADHD (or “boredom sensitivity” as I prefer to call it). By the time I get to <code>return 4</code> there’s no way I’m <em>not</em> going to generalize.</p><p>“Golfing” is reducing code to the fewest possible tokens (the result is generally unreadable, but it’s a good skill in small doses). There’s an equivalent to golfing in TDD—what are the fewest tests &amp; the earliest generalization that results in code with the desired behavior? Maybe we should have speedrun TDD contests?</p><h2>Coda: Coupling</h2><p>The naive implementation above is coupled, in an Empirical Software Design sense, to the test. Every time we add a new assertion we have to change the function. Generalizing eliminates test/implementation coupling. We’re free to add tests (if we feel like it) without changing the code, just as we are free to change the code without changing the tests. (Exercise for the reader—incrementally replace recursion with iteration.)</p>