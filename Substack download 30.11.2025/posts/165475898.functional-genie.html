<p>I’m working on a project in Rust to build a performance-competitive, library-quality <a href="https://github.com/KentBeck/BPlusTree3">implementation of a map</a> with sorted keys.</p><p>Since it's a new language for me, I didn't notice the genie using an awkward idiom when calling functions that return an <a href="https://www.perplexity.ai/search/tutorial-about-option-in-rust-BuTyZCNMQDq_qlK0CsAdPQ">Option</a>. The (apparently) default style is to explicitly check results with an if statement.</p><pre><code>if let Some(left) = self.get_branch_mut(left_id) {
  left.merge_from(key, &amp;mut child_branch);
} else {
  return false;
}</code></pre><p>Cascade a few of these &amp; we end up with deeply nested conditionals. Deeply nested conditionals are where bugs breed &amp; reading comprehension fizzles.</p><p>Instead, we can use the Option combinator:</p><pre><code>self.get_branch_mut(left_id)
    .map(|left| left.merge_from(key, &amp;mut child_branch))
    .is_some()</code></pre><p>These two expressions are semantically equivalent, but I find the second much easier to read. The main flow (from <a href="https://www.amazon.com/Implementation-Patterns-Addison-Wesley-Signature-Beck-ebook/dp/B004UAALDW">Implementation Patterns</a>) reads naturally—get a mutable branch, merge, &amp; return the result. If something goes wrong along the way, that will be handled by the caller.</p><h2>Functional Genie</h2><p>In my project &amp; since I’m still getting used to Rust, the genie wrote a slew of explicit conditionals. I knew something was wrong with all those conditionals but I didn’t know what to do.</p><p>Eventually I asked the genie &amp; it suggested the Option combinator. Okay. A day later I had replaced almost all the explicit conditions, everything was running, and I understood the Option combinator through all the examples I had seen.</p><p>Better to prevent problems that resolve them, though. I asked the genie what I should have added to the system prompt to get it to write in the function composition style in the first place. It said:</p><blockquote><p>"Prefer functional programming style over imperative style in Rust. Use Option and Result combinators (map, and_then, unwrap_or, etc.) instead of pattern matching with if let or match when possible."</p></blockquote><h2>Double Loop Learning</h2><p>This is both a useful snippet of prompt &amp; also an example of second derivative learning. </p><ol><li><p>Learn to use the genie to augment your taste &amp; judgement.</p></li><li><p>Steadily improve your genie wrangling skills through experiment &amp; reflection.</p></li><li><p>But also, and this is the cool part, use the genie to augment your learning.</p></li></ol><p>Not only are you coding better, not only are you learning to code even better than that, but you are accelerating the rate at which you are learning to code better.</p>