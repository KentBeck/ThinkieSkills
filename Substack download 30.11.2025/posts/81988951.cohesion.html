<p>We want to change a couple of lines in the middle of a big long function. First we extract a helper function of just the lines we want to change. Then we change those lines. Then we inline the helper function back into the original function. And this was good technique. What just happened?</p><p>Finally, we come to the topic that took me the longest time to understand well enough to explain. I understood the definition of cohesion just fine, I just couldn't articulate why it was important, why more cohesion is generally better. You can tell me at the end of the chapter if I got it.</p><p>We'll start by assuming that some coupling is inevitable. Perhaps we chose a coupled design on purpose because of discounted cash flows. Perhaps we don't know how to eliminate coupling. Our design skill &amp; experience isn't up to the task. Perhaps we started making a change that uncovered unsuspected coupling. Anyway, we have some coupling and we're going to pay the price of it the next time we want to change the behavior of the system.</p><p>What can we do?</p><p>Walking around a messy farmyard, you have to watch every step you take. What can we do? Put all the manure in one pile. That's what we do with cohesion--put everything that changes at the same time in one place.</p><div class="paywall-jump" data-component-name="PaywallToDOM"></div><p>An element is cohesive to the degree that its subelements are coupled. A perfectly cohesive elements requires all subelements to change at the same time.</p><p>Wait!? Isn't coupling bad? But cohesion is good? But cohesion is coupling of subelements? Isn't that bad? And good?</p><p>This is where I got stuck for a long time (years). What I was missing was the "compared to what?" perspective. Yes, coupling is expensive. But if we accept that some coupling is inevitable, do we want that coupling to be expensive or really really expensive? Those are our choices (until we can design away the coupling, anyway).</p><p>Diagrammatically, suppose the triangular elements are coupled. Suppose we have this situation:</p><div class="captioned-image-container"><figure><a class="image-link image2 is-viewable-img" target="_blank" href="https://substackcdn.com/image/fetch/$s_!lGma!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fb8f255ce-496a-4d74-9d4b-c3b0d0ac73a7_1354x1163.png" data-component-name="Image2ToDOM"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/$s_!lGma!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fb8f255ce-496a-4d74-9d4b-c3b0d0ac73a7_1354x1163.png 424w, https://substackcdn.com/image/fetch/$s_!lGma!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fb8f255ce-496a-4d74-9d4b-c3b0d0ac73a7_1354x1163.png 848w, https://substackcdn.com/image/fetch/$s_!lGma!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fb8f255ce-496a-4d74-9d4b-c3b0d0ac73a7_1354x1163.png 1272w, https://substackcdn.com/image/fetch/$s_!lGma!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fb8f255ce-496a-4d74-9d4b-c3b0d0ac73a7_1354x1163.png 1456w" sizes="100vw"><img src="https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com/public/images/b8f255ce-496a-4d74-9d4b-c3b0d0ac73a7_1354x1163.png" width="1354" height="1163" data-attrs="{&quot;src&quot;:&quot;https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com/public/images/b8f255ce-496a-4d74-9d4b-c3b0d0ac73a7_1354x1163.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:1163,&quot;width&quot;:1354,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:1562729,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}" class="sizing-normal" alt="" srcset="https://substackcdn.com/image/fetch/$s_!lGma!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fb8f255ce-496a-4d74-9d4b-c3b0d0ac73a7_1354x1163.png 424w, https://substackcdn.com/image/fetch/$s_!lGma!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fb8f255ce-496a-4d74-9d4b-c3b0d0ac73a7_1354x1163.png 848w, https://substackcdn.com/image/fetch/$s_!lGma!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fb8f255ce-496a-4d74-9d4b-c3b0d0ac73a7_1354x1163.png 1272w, https://substackcdn.com/image/fetch/$s_!lGma!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fb8f255ce-496a-4d74-9d4b-c3b0d0ac73a7_1354x1163.png 1456w" sizes="100vw" loading="lazy"></picture><div class="image-link-expand"><div class="pencraft pc-display-flex pc-gap-8 pc-reset"><button tabindex="0" type="button" class="pencraft pc-reset pencraft icon-container restack-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-refresh-cw"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path><path d="M21 3v5h-5"></path><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path><path d="M8 16H3v5"></path></svg></button><button tabindex="0" type="button" class="pencraft pc-reset pencraft icon-container view-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-maximize2 lucide-maximize-2"><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" x2="14" y1="3" y2="10"></line><line x1="3" x2="10" y1="21" y2="14"></line></svg></button></div></div></div></a></figure></div><p></p><p>To change both triangles, we're going to have to examine the entire tree of elements to make sure we're not accidentally changing behavior we don't want to change. Reviewers (assuming we have them--more on that in the next book) need context about the whole.</p><p>Let's apply some of our magic software design skills &amp; move both coupled elements together somewhere, like this:</p><div class="captioned-image-container"><figure><a class="image-link image2 is-viewable-img" target="_blank" href="https://substackcdn.com/image/fetch/$s_!FrY0!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc46bdd98-1a95-4ad2-9ecd-1d1f2cf83790_1354x1163.png" data-component-name="Image2ToDOM"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/$s_!FrY0!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc46bdd98-1a95-4ad2-9ecd-1d1f2cf83790_1354x1163.png 424w, https://substackcdn.com/image/fetch/$s_!FrY0!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc46bdd98-1a95-4ad2-9ecd-1d1f2cf83790_1354x1163.png 848w, https://substackcdn.com/image/fetch/$s_!FrY0!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc46bdd98-1a95-4ad2-9ecd-1d1f2cf83790_1354x1163.png 1272w, https://substackcdn.com/image/fetch/$s_!FrY0!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc46bdd98-1a95-4ad2-9ecd-1d1f2cf83790_1354x1163.png 1456w" sizes="100vw"><img src="https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com/public/images/c46bdd98-1a95-4ad2-9ecd-1d1f2cf83790_1354x1163.png" width="1354" height="1163" data-attrs="{&quot;src&quot;:&quot;https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com/public/images/c46bdd98-1a95-4ad2-9ecd-1d1f2cf83790_1354x1163.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:1163,&quot;width&quot;:1354,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:1534583,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}" class="sizing-normal" alt="" srcset="https://substackcdn.com/image/fetch/$s_!FrY0!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc46bdd98-1a95-4ad2-9ecd-1d1f2cf83790_1354x1163.png 424w, https://substackcdn.com/image/fetch/$s_!FrY0!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc46bdd98-1a95-4ad2-9ecd-1d1f2cf83790_1354x1163.png 848w, https://substackcdn.com/image/fetch/$s_!FrY0!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc46bdd98-1a95-4ad2-9ecd-1d1f2cf83790_1354x1163.png 1272w, https://substackcdn.com/image/fetch/$s_!FrY0!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc46bdd98-1a95-4ad2-9ecd-1d1f2cf83790_1354x1163.png 1456w" sizes="100vw" loading="lazy"></picture><div class="image-link-expand"><div class="pencraft pc-display-flex pc-gap-8 pc-reset"><button tabindex="0" type="button" class="pencraft pc-reset pencraft icon-container restack-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-refresh-cw"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path><path d="M21 3v5h-5"></path><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path><path d="M8 16H3v5"></path></svg></button><button tabindex="0" type="button" class="pencraft pc-reset pencraft icon-container view-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-maximize2 lucide-maximize-2"><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" x2="14" y1="3" y2="10"></line><line x1="3" x2="10" y1="21" y2="14"></line></svg></button></div></div></div></a></figure></div><p>We are making the same behavior change, but we have less of the system to look at before we make it. Reviewers, same. The chance of missing something is lower. The cost of scanning the affected parts of the system is lower. We make the change quicker &amp; safer, but at the cost of investment into the structure.</p><p>Cohering is a form of tidying first. That's what happened in the example opening this chapter. We needed to change a lower-cohesion function (that is, some statements had to change but most didn't). We created a highly-cohesive subelement (the helper function). We changed it quickly &amp; safely. Then (and this step is optional) we inlined the helper.</p><p>Were the structure changes worth our time? Depends on how much they cost &amp; how much effort they save. In environments where automated refactoring is a cheap part of the normal flow, small structure changes feel almost free.</p><p>We saw a math-y definition of coupling. Here is the math-y definition of cohesion:</p><pre><code><code>cohesive(E, Δ) ≡ coupled(E1, E2, ... En)
</code></code></pre><p>You're a designer, you bump into some coupling, you want to tidy first, but should you go for decoupling or for cohering? If you know how to de-couple &amp; it won't interrupt the flow of behavior changes (more about this in the 3rd book), then go ahead &amp; de-couple.</p><p>I'm frequently grumpy about coupling but I don't know what to do about it. I'm gathering experience, accumulating frustration, awaiting insight. Cohering (increasing cohesion) I can almost always see how to accomplish. Cohering is also generally a small change, while de-coupling can be be large (in the sense of requring many, maybe unsafe, steps). That's why I like focusing on increasing cohesion.</p><p>When you're cohering, don't be surprised if you have to "violate" the current design to accomplishing higher cohesion. "This service can't compute X, it's supposed to be computed in that service over there." This is a good sign. We've learned something about the design. We discovered unsuspected coupling. Now we're doing something about it. (We'll talk in the next book about letting structure problems ripen &amp; not jumping to changes.)</p>