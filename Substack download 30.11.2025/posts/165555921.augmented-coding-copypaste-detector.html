<blockquote><p>I’m going to put little lessons I learn augmented coding here as posts. Posts/notes/chat—Substack has a bit of a product problem. I want these out there, though, so I’ll post them to my paying subscribers first, then make them public in a month or so (if I remember to do so).</p></blockquote><p>The most powerful question in software design is, “What elements would, should I have them, make this problem easy to solve?” This question is the heart of MCETMEC (Make the Change Easy Then Make The Easy Change). I was grumbling to myself about the genie’s inability to ask itself this question when I found a way.</p><p>I’ve complained several times about the genie’s lack of design. The genie will happily add complexity until it’s completely wedged (or, as we say in the nuclear reactor business, “gone solid”.) I’m continually exploring ways to turn the genie’s attention towards improving the design. Here’s a new one.</p><p>So I was working on my B+ Tree project, getting close to the first public release. I wanted the code to be more readable (my eventual goal is to write a literate program from the code, which requires <em>way</em> more readability, but one step at a time). I tried manually prompting it to do some refactorings, which worked okay, but I suspected that there was more cleanup possible.</p><p>The idea was a blend of:</p><ul><li><p>Duplicated code is often a hint of a missing abstraction.</p></li><li><p>A copy/paste detector finds duplicated code.</p></li><li><p>Maybe? the genie can do something about duplicated code.</p></li></ul><p>So I prompted, “run the copy/paste detector over the whole rust codebase to see if there are missing abstractions”. I did this with a free genie (“remote agent”) just to see if this was a good kind of task.</p><p>Spoiler alert: it was a good kind of task for a free genie.</p><p>The genie’s original prediction of line savings vs actual:</p><ul><li><p>Test Setup 400+ lines to 100 lines, actual: 75</p></li><li><p>Invariant Checking 270 lines to 50, actual: 50</p></li><li><p>Attack Patterns 200 lines to 60, actual: 60</p></li><li><p>Arena Operations 160 lines to 55, actual: 60</p></li><li><p><strong>TOTAL 1,030+ lines to 265, actual: 270</strong></p></li></ul><p>Pretty dang close!</p><p>Now, fewer lines isn’t always better. We don’t want to get into infinite code compression at the expense of comprehension. But <a href="https://github.com/KentBeck/BPlusTree3/commit/f2ea50c397e3b70958ab549e7bd9e0f29bdb07b3">reviewing the change</a> the genie actually did a good job of clarifying the code by reducing duplication. Try it!</p><p></p>